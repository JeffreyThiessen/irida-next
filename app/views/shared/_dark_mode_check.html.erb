<script>
  // On page load or when changing themes, best to add inline in `head` to avoid FOUC
  if (localStorage.theme === "dark" || (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
    document.documentElement.classList.add("dark");
  } else {
    document.documentElement.classList.remove("dark");
  }

  window.addEventListener("storage", function(event) {
    if (this.localStorage.getItem("theme") === "light") {
      if (document.documentElement.classList.contains("dark")) {
        this.document.documentElement.classList.remove("dark");
        this.document.querySelector("#app-darkmode-toggle>svg[data-dark-mode-target=darkIcon]").classList.remove("hidden");
        this.document.querySelector("#app-darkmode-toggle>svg[data-dark-mode-target=lightIcon]").classList.add("hidden");
      }
    } else if (this.localStorage.getItem("theme") === "dark") {
      if (!document.documentElement.classList.contains("dark")) {
        this.document.documentElement.classList.add("dark");
        this.document.querySelector("#app-darkmode-toggle>svg[data-dark-mode-target=darkIcon]").classList.add("hidden");
        this.document.querySelector("#app-darkmode-toggle>svg[data-dark-mode-target=lightIcon]").classList.remove("hidden");
      }
    }
  });
</script>
